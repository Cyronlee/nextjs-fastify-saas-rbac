{"version":3,"sources":["../../../src/http/emails/transfer-organization-ownership-email.ts","../../../../../node_modules/.pnpm/@t3-oss+env-core@0.11.1_typescript@5.6.3_zod@3.23.8/node_modules/@t3-oss/env-core/dist/index.js","../../../../../node_modules/.pnpm/@t3-oss+env-nextjs@0.11.1_typescript@5.6.3_zod@3.23.8/node_modules/@t3-oss/env-nextjs/dist/index.js","../../../../../packages/env/index.ts","../../../src/lib/mail.ts","../../../src/http/emails/template/transfer-organization-ownership-email.template.ts"],"sourcesContent":["import { env } from '@saas/env'\nimport Mail from 'nodemailer/lib/mailer'\n\nimport { emailService } from '@/lib/mail'\n\nimport { transferOrganizationOwnershipEmailTemplate } from './template/transfer-organization-ownership-email.template'\n\ninterface TransferOrganizationOwnershipParams {\n\torganizationName: string\n\ttargetName: string\n\ttargetEmail: string\n}\n\nexport async function transferOrganizationOwnershipEmail({\n\torganizationName,\n\ttargetName,\n\ttargetEmail,\n}: TransferOrganizationOwnershipParams) {\n\tconst htmlTemplate = transferOrganizationOwnershipEmailTemplate({\n\t\ttargetName,\n\t\torganizationName,\n\t})\n\n\tconst emailOptions: Mail.Options = {\n\t\tfrom: env.MAIL_SMTP_EMAIL,\n\t\tto: targetEmail,\n\t\tsubject: `${organizationName} Ownership Transfer`,\n\t\thtml: htmlTemplate,\n\t}\n\n\tawait emailService.sendMail(emailOptions)\n}\n","import { object } from 'zod';\n\nfunction createEnv(opts) {\n    const runtimeEnv = opts.runtimeEnvStrict ?? opts.runtimeEnv ?? process.env;\n    const emptyStringAsUndefined = opts.emptyStringAsUndefined ?? false;\n    if (emptyStringAsUndefined) {\n        for (const [key, value] of Object.entries(runtimeEnv)){\n            if (value === \"\") {\n                delete runtimeEnv[key];\n            }\n        }\n    }\n    const skip = !!opts.skipValidation;\n    // biome-ignore lint/suspicious/noExplicitAny: <explanation>\n    if (skip) return runtimeEnv;\n    const _client = typeof opts.client === \"object\" ? opts.client : {};\n    const _server = typeof opts.server === \"object\" ? opts.server : {};\n    const _shared = typeof opts.shared === \"object\" ? opts.shared : {};\n    const client = object(_client);\n    const server = object(_server);\n    const shared = object(_shared);\n    const isServer = opts.isServer ?? (typeof window === \"undefined\" || \"Deno\" in window);\n    const allClient = client.merge(shared);\n    const allServer = server.merge(shared).merge(client);\n    const parsed = isServer ? allServer.safeParse(runtimeEnv) // on server we can validate all env vars\n     : allClient.safeParse(runtimeEnv); // on client we can only validate the ones that are exposed\n    const onValidationError = opts.onValidationError ?? ((error)=>{\n        console.error(\"❌ Invalid environment variables:\", error.flatten().fieldErrors);\n        throw new Error(\"Invalid environment variables\");\n    });\n    const onInvalidAccess = opts.onInvalidAccess ?? ((_variable)=>{\n        throw new Error(\"❌ Attempted to access a server-side environment variable on the client\");\n    });\n    if (parsed.success === false) {\n        return onValidationError(parsed.error);\n    }\n    const isServerAccess = (prop)=>{\n        if (!opts.clientPrefix) return true;\n        return !prop.startsWith(opts.clientPrefix) && !(prop in shared.shape);\n    };\n    const isValidServerAccess = (prop)=>{\n        return isServer || !isServerAccess(prop);\n    };\n    const ignoreProp = (prop)=>{\n        return prop === \"__esModule\" || prop === \"$$typeof\";\n    };\n    const extendedObj = (opts.extends ?? []).reduce((acc, curr)=>{\n        return Object.assign(acc, curr);\n    }, {});\n    const fullObj = Object.assign(parsed.data, extendedObj);\n    const env = new Proxy(fullObj, {\n        get (target, prop) {\n            if (typeof prop !== \"string\") return undefined;\n            if (ignoreProp(prop)) return undefined;\n            if (!isValidServerAccess(prop)) return onInvalidAccess(prop);\n            return Reflect.get(target, prop);\n        }\n    });\n    // biome-ignore lint/suspicious/noExplicitAny: <explanation>\n    return env;\n}\n\nexport { createEnv };\n","import { createEnv as createEnv$1 } from '@t3-oss/env-core';\n\nconst CLIENT_PREFIX = \"NEXT_PUBLIC_\";\nfunction createEnv(opts) {\n    const client = typeof opts.client === \"object\" ? opts.client : {};\n    const server = typeof opts.server === \"object\" ? opts.server : {};\n    const shared = opts.shared;\n    const runtimeEnv = opts.runtimeEnv ? opts.runtimeEnv : {\n        ...process.env,\n        ...opts.experimental__runtimeEnv\n    };\n    return createEnv$1({\n        ...opts,\n        shared,\n        client,\n        server,\n        clientPrefix: CLIENT_PREFIX,\n        runtimeEnv\n    });\n}\n\nexport { createEnv };\n","/* eslint-disable prettier/prettier */\nimport { createEnv } from '@t3-oss/env-nextjs'\nimport { z } from 'zod'\n\nexport const env = createEnv({\n\tserver: {\n\t\tDATABASE_URL: z.string(),\n\t\tPORT: z.coerce.number().default(3333),\n\n\t\tJWT_SECRET_KEY: z.string(),\n\t\tJWT_PUBLIC_KEY: z.string(),\n\n\t\tGITHUB_OAUTH_CLIENT_ID: z.string(),\n\t\tGITHUB_OAUTH_CLIENT_SECRET: z.string(),\n\t\tGITHUB_OAUTH_CLIENT_REDIRECT_URI: z.string().url(),\n\t\tGITHUB_OAUTH_CLIENT_SCOPE: z.string().default('user'),\n\n\t\tGOOGLE_OAUTH_CLIENT_ID: z.string(),\n\t\tGOOGLE_OAUTH_CLIENT_SECRET: z.string(),\n\t\tGOOGLE_OAUTH_CLIENT_REDIRECT_URI: z.string().url(),\n\t\tGOOGLE_OAUTH_CLIENT_RESPONSE_TYPE: z.string().default('code'),\n\t\tGOOGLE_OAUTH_CLIENT_SCOPE: z.string().default('https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile'),\n\n\t\tMAIL_SMTP_HOST: z.string().default('smtp.gmail.com'),\n\t\tMAIL_SMTP_PORT: z.coerce.number().default(465),\n\t\tMAIL_SMTP_EMAIL: z.string(),\n\t\tMAIL_SMTP_PASSWORD: z.string(),\n\n\t\tCLOUDFLARE_ACCOUNT_ID: z.string(),\n\t\tCLOUDFLARE_ENDPOINT: z.string(),\n\t\tCLOUDFLARE_BUCKET: z.string(),\n\t\tCLOUDFLARE_REGION: z.string().default('auto'),\n\t\tCLOUDFLARE_ACCESS_KEY: z.string(),\n\t\tCLOUDFLARE_SECRET_KEY: z.string(),\n\t},\n\n\tclient: {},\n\n\tshared: {\n\t\tNEXT_PUBLIC_URL: z.string().url(),\n\t\tNEXT_PUBLIC_API_URL: z.string().url(),\n\t\tNEXT_PUBLIC_CLOUDFLARE_URL: z.string(),\n\t},\n\n\truntimeEnv: {\n\t\tDATABASE_URL: process.env.DATABASE_URL,\n\t\tPORT: process.env.PORT,\n\t\tNEXT_PUBLIC_URL: process.env.NEXT_PUBLIC_URL,\n\t\tNEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL,\n\t\tJWT_SECRET_KEY: process.env.JWT_SECRET_KEY,\n\t\tJWT_PUBLIC_KEY: process.env.JWT_PUBLIC_KEY,\n\t\tGITHUB_OAUTH_CLIENT_ID: process.env.GITHUB_OAUTH_CLIENT_ID,\n\t\tGITHUB_OAUTH_CLIENT_SECRET: process.env.GITHUB_OAUTH_CLIENT_SECRET,\n\t\tGITHUB_OAUTH_CLIENT_REDIRECT_URI: process.env.GITHUB_OAUTH_CLIENT_REDIRECT_URI,\n\t\tGITHUB_OAUTH_CLIENT_SCOPE: process.env.GITHUB_OAUTH_CLIENT_SCOPE,\n\t\tGOOGLE_OAUTH_CLIENT_ID: process.env.GOOGLE_OAUTH_CLIENT_ID,\n\t\tGOOGLE_OAUTH_CLIENT_SECRET: process.env.GOOGLE_OAUTH_CLIENT_SECRET,\n\t\tGOOGLE_OAUTH_CLIENT_REDIRECT_URI: process.env.GOOGLE_OAUTH_CLIENT_REDIRECT_URI,\n\t\tGOOGLE_OAUTH_CLIENT_RESPONSE_TYPE: process.env.GOOGLE_OAUTH_CLIENT_RESPONSE_TYPE,\n\t\tGOOGLE_OAUTH_CLIENT_SCOPE: process.env.GOOGLE_OAUTH_CLIENT_SCOPE,\n\t\tMAIL_SMTP_HOST: process.env.MAIL_SMTP_HOST,\n\t\tMAIL_SMTP_PORT: process.env.MAIL_SMTP_PORT,\n\t\tMAIL_SMTP_EMAIL: process.env.MAIL_SMTP_EMAIL,\n\t\tMAIL_SMTP_PASSWORD: process.env.MAIL_SMTP_PASSWORD,\n\t\tCLOUDFLARE_ACCOUNT_ID: process.env.CLOUDFLARE_ACCOUNT_ID,\n\t\tCLOUDFLARE_ENDPOINT: process.env.CLOUDFLARE_ENDPOINT,\n\t\tCLOUDFLARE_BUCKET: process.env.CLOUDFLARE_BUCKET,\n\t\tCLOUDFLARE_REGION: process.env.CLOUDFLARE_REGION,\n\t\tCLOUDFLARE_ACCESS_KEY: process.env.CLOUDFLARE_ACCESS_KEY,\n\t\tCLOUDFLARE_SECRET_KEY: process.env.CLOUDFLARE_SECRET_KEY,\n\t\tNEXT_PUBLIC_CLOUDFLARE_URL: process.env.NEXT_PUBLIC_CLOUDFLARE_URL,\n\t},\n\temptyStringAsUndefined: true,\n})\n","import { env } from '@saas/env'\nimport nodemailer from 'nodemailer'\n\nexport const emailService = nodemailer.createTransport({\n\thost: env.MAIL_SMTP_HOST,\n\tport: env.MAIL_SMTP_PORT,\n\tsecure: true,\n\tauth: {\n\t\tuser: env.MAIL_SMTP_EMAIL,\n\t\tpass: env.MAIL_SMTP_PASSWORD,\n\t},\n})\n","import { env } from '@saas/env'\n\ninterface TransferOrganizationEmailTemplateParams {\n\torganizationName: string\n\ttargetName: string | null\n}\n\nexport function transferOrganizationOwnershipEmailTemplate({\n\torganizationName,\n\ttargetName,\n}: TransferOrganizationEmailTemplateParams) {\n\treturn `\n\t\t<p style=\"margin:0 0 0.25rem;line-height:1.5;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:14px;\">\n\t\t\tHi, ${targetName ? targetName.split(' ').at(0) + '!' : ''}\n\t\t</p>\n\t\t<p style=\"margin:0 0 1rem;line-height:1.5;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:14px;\">\n\t\t\tYou have been designated as the new administrator of ${organizationName}. You now have full access to manage organization settings and projects.\n\t\t</p>\n\t\t<p style=\"margin:0 0 0.25rem;line-height:1.5;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:14px;\">\n\t\t\tWelcome, and congratulations on your new role!\n\t\t\t<br />\n\t\t\t<a href=\"${env.NEXT_PUBLIC_URL}\" style=\"text-decoration:underline;color:currentColor;\">Get it started</a>\n\t\t</p>\n\t`\n}\n"],"mappings":"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","names":["env","createEnv","import_zod","createEnv","nodemailer"]}